# 👤 管理员账号与权限说明

## 🔑 管理员账号

### 预设管理员账号

系统已预设一个管理员账号：

- **用户名**: `admin`
- **密码**: `123456`
- **邮箱**: `admin@jeyi.com`
- **角色**: `admin`

⚠️ **安全提示**: 首次登录后请立即修改密码！

### 创建其他管理员

所有用户注册时默认角色都是 **`user`（普通用户）**，需要手动将用户角色设置为 **`admin`（管理员）**。

### 如何设置管理员

#### 方法一：使用 MongoDB Shell（推荐）

1. 打开终端，连接 MongoDB：
```bash
mongosh jeyi-toolhub
```

2. 查看所有用户：
```javascript
db.users.find().pretty()
```

3. 将指定用户设置为管理员：
```javascript
// 通过用户名设置
db.users.updateOne(
  { username: "你的用户名" },
  { $set: { role: "admin" } }
)

// 或通过邮箱设置
db.users.updateOne(
  { email: "你的邮箱" },
  { $set: { role: "admin" } }
)
```

4. 验证设置是否成功：
```javascript
db.users.findOne({ username: "你的用户名" })
// 查看返回结果中的 role 字段应该是 "admin"
```

#### 方法二：使用 MongoDB Compass（图形界面）

1. 打开 MongoDB Compass
2. 连接到 `mongodb://localhost:27017`
3. 选择数据库 `jeyi-toolhub`
4. 选择集合 `users`
5. 找到要设置为管理员的用户文档
6. 编辑文档，将 `role` 字段的值从 `"user"` 改为 `"admin"`
7. 保存更改

## 🔐 管理员权限详解

### 1. 工具访问权限

#### 普通用户（user）
- ✅ 可以访问所有 `access: "all"` 的工具
- ❌ 无法访问 `access: "admin"` 的工具

#### 管理员（admin）
- ✅ 可以访问**所有工具**（包括 `access: "all"` 和 `access: "admin"`）
- ✅ 在工具列表中可以看到所有工具，不受权限限制

### 2. 工具管理权限

#### 创建工具
- **接口**: `POST /api/tools`
- **权限**: 仅管理员
- **功能**: 
  - 添加新工具到平台
  - 设置工具名称、分类、GitHub链接、图标、版本、描述
  - 设置访问权限（所有用户 / 仅管理员）

#### 编辑工具
- **接口**: `PUT /api/tools/:id`
- **权限**: 仅管理员
- **功能**:
  - 修改工具的所有信息
  - 更新工具版本号
  - 修改工具描述和分类

#### 删除工具
- **接口**: `DELETE /api/tools/:id`
- **权限**: 仅管理员
- **功能**:
  - 从平台中删除工具
  - 删除后工具将不再显示在列表中

### 3. 管理后台访问

#### 管理后台入口
- 登录后，管理员可以看到右上角的 **"管理后台"** 按钮
- 普通用户看不到此按钮

#### 管理后台功能
1. **工具管理**
   - 查看所有工具列表
   - 添加新工具
   - 编辑工具信息
   - 删除工具

2. **用户管理**（界面已准备，功能待完善）
   - 查看所有用户列表
   - 查看用户信息（用户名、邮箱、角色、注册时间等）
   - 未来可扩展：冻结用户、删除用户、重置密码等功能

### 4. 版本管理

#### 版本检查
- 所有登录用户都可以检查版本更新
- 管理员可以查看所有工具的版本信息

#### 版本历史
- 可以查看工具的版本历史记录
- 未来可扩展：管理员可以添加版本记录

## 📋 权限对比表

| 功能 | 普通用户 | 管理员 |
|------|---------|--------|
| 注册账号 | ✅ | ✅ |
| 登录系统 | ✅ | ✅ |
| 查看工具列表 | ✅（仅公开工具） | ✅（所有工具） |
| 使用工具 | ✅（仅公开工具） | ✅（所有工具） |
| 搜索工具 | ✅ | ✅ |
| 分类筛选 | ✅ | ✅ |
| 查看个人信息 | ✅ | ✅ |
| 修改密码 | ✅ | ✅ |
| 访问管理后台 | ❌ | ✅ |
| 添加工具 | ❌ | ✅ |
| 编辑工具 | ❌ | ✅ |
| 删除工具 | ❌ | ✅ |
| 查看所有用户 | ❌ | ✅（待完善） |

## 🛡️ 安全机制

### 权限验证
- 所有需要管理员权限的操作都经过后端验证
- 使用 JWT Token 进行身份认证
- 前端隐藏管理功能，但后端会再次验证权限

### 权限中间件
后端使用 `requireAdmin` 中间件保护管理员接口：
```javascript
// 只有管理员可以访问
router.post('/', authenticate, requireAdmin, ...)
router.put('/:id', authenticate, requireAdmin, ...)
router.delete('/:id', authenticate, requireAdmin, ...)
```

### 权限检查流程
1. 前端检查用户角色，显示/隐藏管理功能
2. 用户操作时，请求携带 JWT Token
3. 后端验证 Token 并检查用户角色
4. 如果角色不是 `admin`，返回 403 错误

## 📝 使用建议

### 首次使用
1. 使用预设管理员账号登录：
   - 用户名: `admin`
   - 密码: `123456`
2. 登录后即可看到"管理后台"按钮
3. 开始添加工具
4. **重要**: 首次登录后请立即修改密码！

### 创建新的管理员账号

如果需要创建新的管理员账号，可以使用以下方法：

#### 方法一：使用脚本（推荐）

```bash
cd /Users/bupoo/Github/AIO2/backend
node scripts/createAdmin.js
```

然后修改脚本中的用户名、邮箱和密码。

#### 方法二：使用 MongoDB

### 多管理员管理
- 可以设置多个管理员账号
- 所有管理员拥有相同的权限
- 建议为不同管理员设置不同的账号，便于追踪操作

### 工具权限设置
- **所有用户（all）**: 普通用户和管理员都可以访问
- **仅管理员（admin）**: 只有管理员可以访问，适合内部工具或测试工具

## ⚠️ 注意事项

1. **管理员账号安全**
   - 管理员账号拥有完整权限，请妥善保管
   - 建议使用强密码
   - 不要将管理员账号信息泄露

2. **工具权限设置**
   - 设置工具为"仅管理员"时，普通用户将无法看到该工具
   - 请谨慎设置工具权限

3. **数据安全**
   - 删除工具操作不可恢复，请谨慎操作
   - 建议定期备份数据库

## 🔧 常见问题

### Q: 如何查看当前用户是否是管理员？
A: 登录后，如果能看到右上角的"管理后台"按钮，说明是管理员。

### Q: 设置管理员后需要重新登录吗？
A: 是的，建议刷新页面或重新登录，JWT Token 会更新用户信息。

### Q: 可以撤销管理员权限吗？
A: 可以，使用 MongoDB 将用户的 `role` 字段改回 `"user"` 即可。

### Q: 忘记管理员账号怎么办？
A: 可以使用 MongoDB 查看所有用户，找到管理员账号：
```javascript
db.users.find({ role: "admin" })
```

---

**最后更新**: 2025-11-11

